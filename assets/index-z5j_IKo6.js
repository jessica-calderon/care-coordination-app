const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Landing-C_KmipBN.js","assets/react-vendor-Bd7vrGHb.js","assets/vendor-B589Owoc.js","assets/fontawesome-vendor-BCNoqndA.js","assets/firebase-vendor-BzYfHYoF.js","assets/Today-BN79fusM.js","assets/InlineSpinner-DVngfXjU.js","assets/CareTeam-BI-BG7Kj.js","assets/About-Cda3p7yt.js","assets/HowItWorks-Bv6prXzE.js","assets/Privacy-E4reZOwD.js"])))=>i.map(i=>d[i]);
import{r as b,j as y,F as W,c as Te}from"./react-vendor-Bd7vrGHb.js";import{f as Ee,a as De,b as Pe,d as Re,e as Be,g as Le,h as je,j as Ue,k as _e,l as Oe,m as Ke,n as Fe,o as $e,q as Me,r as ze}from"./fontawesome-vendor-BCNoqndA.js";import{n as R}from"./vendor-B589Owoc.js";import{g as Z,i as qe,a as We,b as He,c as H,d as U,e as g,f as D,s as v,T,u as L}from"./firebase-vendor-BzYfHYoF.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=t(a);fetch(a.href,r)}})();const Ye="modulepreload",Ge=function(o){return"/care-coordination-app/"+o},ee={},F=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){let i=function(l){return Promise.all(l.map(d=>Promise.resolve(d).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),c=n?.nonce||n?.getAttribute("nonce");a=i(t.map(l=>{if(l=Ge(l),l in ee)return;ee[l]=!0;const d=l.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":Ye,d||(u.as="script"),u.crossOrigin="",u.href=l,c&&u.setAttribute("nonce",c),document.head.appendChild(u),d)return new Promise((m,h)=>{u.addEventListener("load",m),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(n){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=n,window.dispatchEvent(c),!c.defaultPrevented)throw n}return a.then(n=>{for(const c of n||[])c.status==="rejected"&&r(c.reason);return e().catch(r)})},M={tasks:_e,caregiver:Ke,handoff:Oe,time:Ue,notebook:Pe,brand:Fe,back:Ee,listItem:De,quickNote:Re,careNotes:Be,moon:Me,sun:ze,chevronDown:je,chevronUp:Le,careTeam:$e},te="care-app-theme";function Je(){const[o,e]=b.useState(()=>{const s=localStorage.getItem(te);let a;return s==="light"||s==="dark"?a=s:window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?a="dark":a="light",document.documentElement.setAttribute("data-theme",a),a});return b.useEffect(()=>{document.documentElement.setAttribute("data-theme",o),localStorage.setItem(te,o)},[o]),{theme:o,toggleTheme:()=>{e(s=>s==="light"?"dark":"light")}}}function Ve({children:o,onNavigateHome:e,onNavigateCareTeam:t,onNavigateBack:s,currentView:a}){const r=a==="home",n=a==="today",c=a==="careTeam",i=a==="about"||a==="howItWorks"||a==="privacy",{theme:l,toggleTheme:d}=Je(),f=()=>{c&&s?s():e()};return y.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"var(--bg-primary)"},children:[y.jsx("header",{className:"border-b",style:{borderColor:"var(--border-color)"},role:"banner",children:y.jsxs("nav",{className:"px-6 py-4 max-w-2xl mx-auto flex items-center justify-between","aria-label":"Main navigation",children:[y.jsx("div",{className:"flex-1",children:r?y.jsxs("div",{className:"text-base inline-flex items-center",style:{color:"var(--text-secondary)"},children:[y.jsx(W,{icon:M.brand,className:"mr-2 opacity-55",style:{fontSize:"0.8em"},"aria-hidden":"true"}),y.jsx("span",{children:"Care Notebook"})]}):y.jsxs("button",{type:"button",onClick:f,className:"text-base focus:outline-none focus:ring-2 rounded px-2 py-1 transition-all cursor-pointer inline-flex items-center hover:-translate-x-0.5 hover:opacity-80",style:{color:"var(--text-secondary)","--tw-ring-color":"var(--focus-ring)"},"aria-label":c?"Navigate back to Today":"Navigate to home page",children:[y.jsx(W,{icon:M.back,className:"mr-2 opacity-60",style:{fontSize:"0.85em"},"aria-hidden":"true"}),y.jsx("span",{children:"Care Notebook"})]})}),y.jsxs("div",{className:"flex items-center gap-2",children:[n&&t&&y.jsxs("button",{type:"button",onClick:t,className:"px-3 py-2 rounded-md focus:outline-none focus:ring-2 transition-colors cursor-pointer inline-flex items-center gap-2 hover:opacity-80",style:{color:"var(--text-secondary)","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Care Team",title:"Care Team",children:[y.jsx(W,{icon:M.careTeam,style:{fontSize:"1em"},"aria-hidden":"true"}),y.jsx("span",{className:"text-sm hidden sm:inline",children:"Care Team"})]}),y.jsx("button",{type:"button",onClick:d,className:"p-2 rounded-md focus:outline-none focus:ring-2 transition-colors cursor-pointer hover:opacity-80",style:{color:"var(--text-secondary)","--tw-ring-color":"var(--focus-ring)"},"aria-label":l==="light"?"Switch to dark mode":"Switch to light mode",title:l==="light"?"Switch to dark mode":"Switch to light mode","aria-pressed":l==="dark",children:y.jsx(W,{icon:l==="light"?M.moon:M.sun,style:{fontSize:"1em",color:"var(--text-secondary)"},"aria-hidden":"true"})})]})]})}),y.jsx("main",{role:"main",children:o})]})}function Qe({onNavigateAbout:o,onNavigateHowItWorks:e,onNavigatePrivacy:t}){const s=n=>{n.preventDefault(),o?.()},a=n=>{n.preventDefault(),e?.()},r=n=>{n.preventDefault(),t?.()};return y.jsx("footer",{className:"border-t py-6 px-6",style:{borderColor:"var(--border-color)",backgroundColor:"var(--bg-primary)"},role:"contentinfo",children:y.jsx("div",{className:"max-w-2xl mx-auto",children:y.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 sm:gap-6 text-sm",style:{color:"var(--text-muted)"},children:[y.jsxs("div",{className:"flex-shrink-0",children:[y.jsx("p",{className:"font-medium",style:{color:"var(--text-secondary)"},children:"Care Notebook · v0.2.0"}),y.jsx("p",{className:"text-xs mt-0.5",children:"Shared care, simply."})]}),y.jsx("div",{className:"flex-shrink-0 text-center sm:text-left",children:y.jsx("small",{style:{color:"var(--text-muted)"},children:"Stored securely in the cloud"})}),y.jsx("nav",{className:"flex-shrink-0","aria-label":"Footer navigation",children:y.jsxs("ul",{className:"flex flex-wrap gap-4 sm:gap-6",children:[y.jsx("li",{children:y.jsx("a",{href:"#",onClick:s,className:"hover:underline focus:outline-none focus:ring-2 focus:ring-offset-2 rounded px-1 transition-colors hover:opacity-80",style:{color:"var(--text-muted)","--tw-ring-color":"var(--focus-ring)"},"aria-label":"About Care Notebook",children:"About"})}),y.jsx("li",{children:y.jsx("a",{href:"#",onClick:a,className:"hover:underline focus:outline-none focus:ring-2 focus:ring-offset-2 rounded px-1 transition-colors hover:opacity-80",style:{color:"var(--text-muted)","--tw-ring-color":"var(--focus-ring)"},"aria-label":"How it works",children:"How it works"})}),y.jsx("li",{children:y.jsx("a",{href:"#",onClick:r,className:"hover:underline focus:outline-none focus:ring-2 focus:ring-offset-2 rounded px-1 transition-colors hover:opacity-80",style:{color:"var(--text-muted)","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Privacy information",children:"Privacy"})})]})})]})})})}function Xe({isOpen:o,onClose:e,onSubmit:t,initialValue:s="",title:a,submitLabel:r}){const[n,c]=b.useState(s),i=b.useRef(null);b.useEffect(()=>{o&&(c(s),i.current&&(i.current.focus(),i.current.select()))},[o,s]);const l=d=>{d.preventDefault();const f=n.trim();f&&(t(f),c(""))};return o?y.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},onClick:e,role:"dialog","aria-modal":"true","aria-labelledby":"caree-name-modal-title",children:y.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg max-w-md w-full p-6",style:{backgroundColor:"var(--bg-primary)",color:"var(--text-primary)"},onClick:d=>d.stopPropagation(),children:[y.jsx("h2",{id:"caree-name-modal-title",className:"text-xl font-normal mb-4",style:{color:"var(--text-primary)"},children:a||"Start new notebook"}),y.jsx("p",{className:"text-sm mb-4",style:{color:"var(--text-secondary)"},children:"Who are you caring for?"}),y.jsxs("form",{onSubmit:l,children:[y.jsx("label",{htmlFor:"caree-name-input",className:"sr-only",children:"Care recipient name"}),y.jsx("input",{id:"caree-name-input",ref:i,type:"text",value:n,onChange:d=>c(d.target.value),placeholder:"e.g. Mom, Dad, Wela",className:"w-full px-4 py-3 text-base rounded-lg border focus:outline-none focus:ring-2 focus:border-transparent mb-4",style:{color:"var(--text-primary)",backgroundColor:"var(--bg-primary)",borderColor:"var(--border-color)","--tw-ring-color":"var(--focus-ring)"},required:!0,"aria-label":"Care recipient name","aria-required":"true"}),y.jsxs("div",{className:"flex gap-3 justify-end",children:[y.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-base font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Cancel",children:"Cancel"}),y.jsx("button",{type:"submit",className:"px-6 py-2 text-base font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80",style:{color:"var(--button-secondary-text)",backgroundColor:"var(--button-secondary-bg)","--tw-ring-color":"var(--focus-ring)"},onMouseEnter:d=>{d.currentTarget.style.backgroundColor="var(--button-secondary-bg-hover)"},onMouseLeave:d=>{d.currentTarget.style.backgroundColor="var(--button-secondary-bg)"},"aria-label":r||"Create notebook",children:r||"Create notebook"})]})]})]})}):null}const Ze={sm:{width:"1rem",height:"1rem",borderWidth:"2px"},md:{width:"1.5rem",height:"1.5rem",borderWidth:"2px"},lg:{width:"2rem",height:"2rem",borderWidth:"3px"}};function et({size:o="md",className:e=""}){const t=Ze[o];return y.jsxs("div",{className:`inline-block ${e}`,role:"status","aria-busy":"true","aria-live":"polite",children:[y.jsx("span",{className:"sr-only",children:"Loading…"}),y.jsx("div",{className:"rounded-full border-solid animate-spin",style:{width:t.width,height:t.height,borderWidth:t.borderWidth,borderTopColor:"var(--text-muted)",borderRightColor:"transparent",borderBottomColor:"transparent",borderLeftColor:"transparent"},"aria-hidden":"true"})]})}function w(){return new Date().toISOString().split("T")[0]}function E(o){const e=o.getHours(),t=o.getMinutes(),s=e>=12?"PM":"AM",a=e%12||12,r=t.toString().padStart(2,"0");return`${a}:${r} ${s}`}function ie(o,e){return{time:E(new Date),note:o.trim(),author:e}}function tt(o,e){return`${o} handed off care to ${e}.`}function ce(o,e){return{time:E(new Date),note:tt(o,e),author:"System"}}function Et(o,e){return o.author==="System"?!1:o.author===e}function Dt(o,e){return o.author==="System"?!1:o.author===e}function de(o,e){return{...o,note:e.trim(),editedAt:new Date().toISOString()}}function at(){return`temp-${Date.now()}-${Math.random().toString(36).substring(2,9)}`}function le(o,e){const t=e.trim();if(!t||o.some(r=>r.name.toLowerCase()===t.toLowerCase()))return o;const a=o.length===0;return[...o,{id:at(),name:t,isPrimary:a,isActive:!0}]}function ue(o,e){const t=e.trim();if(!t)return{caretakers:o,canSetPrimary:!1,reason:"Invalid name"};const s=o.findIndex(n=>n.name.toLowerCase()===t.toLowerCase());if(s===-1)return{caretakers:o,canSetPrimary:!1,reason:"Caretaker not found"};const a=o[s];return a.isActive?a.isPrimary?{caretakers:o,canSetPrimary:!0}:{caretakers:o.map(n=>({...n,isPrimary:n.name.toLowerCase()===t.toLowerCase()})),canSetPrimary:!0}:{caretakers:o,canSetPrimary:!1,reason:"Cannot set inactive caretaker as primary"}}function me(o,e,t){const s=e.trim();if(!s)return{caretakers:o,canArchive:!1,reason:"Invalid name"};const a=o.findIndex(c=>c.name.toLowerCase()===s.toLowerCase());if(a===-1)return{caretakers:o,canArchive:!1,reason:"Caretaker not found"};const r=o[a];return r.isPrimary?{caretakers:o,canArchive:!1,reason:"Cannot archive primary contact"}:s.toLowerCase()===t.toLowerCase()?{caretakers:o,canArchive:!1,reason:"Cannot archive current caregiver"}:r.isActive?{caretakers:o.map(c=>c.name.toLowerCase()===s.toLowerCase()?{...c,isActive:!1}:c),canArchive:!0}:{caretakers:o,canArchive:!0}}function ye(o,e){const t=e.trim();if(!t)return{caretakers:o,canRestore:!1,reason:"Invalid name"};const s=o.findIndex(n=>n.name.toLowerCase()===t.toLowerCase());return s===-1?{caretakers:o,canRestore:!1,reason:"Caretaker not found"}:o[s].isActive?{caretakers:o,canRestore:!0}:{caretakers:o.map(n=>n.name.toLowerCase()===t.toLowerCase()?{...n,isActive:!0}:n),canRestore:!0}}function fe(o){return{time:E(new Date),note:`${o} was added as a caretaker.`,author:"System"}}function he(o){return{time:E(new Date),note:`${o} was archived as a caretaker.`,author:"System"}}function pe(o){return{time:E(new Date),note:`${o} was restored as a caretaker.`,author:"System"}}function ke(o){return{time:E(new Date),note:`${o} was set as the primary contact.`,author:"System"}}function rt(o,e){return{time:E(new Date),note:`Care recipient name changed from "${o}" to "${e}".`,author:"System"}}function ge(o,e){return{time:E(new Date),note:`Caretaker name changed from "${o}" to "${e}".`,author:"System"}}function we(o,e){const t=e.length>100?e.substring(0,100)+"...":e;return{time:E(new Date),note:`${o} deleted a note: "${t}"`,author:"System"}}function ot(o,e){return{time:E(new Date),note:`${o} added a task: "${e}"`,author:"System"}}function st(o,e){return{time:E(new Date),note:`${o} completed the task: "${e}"`,author:"System"}}function nt(o,e){return{time:E(new Date),note:`${o} marked the task as incomplete: "${e}"`,author:"System"}}function it(o,e,t){return{time:E(new Date),note:`${o} updated the task from "${e}" to "${t}"`,author:"System"}}function ct(o,e){return{time:E(new Date),note:`${o} deleted the task: "${e}"`,author:"System"}}const Ce="care-app-notebook-index",Ne="care-app-last-notebook-id";function q(){if(typeof window>"u")return[];try{const o=localStorage.getItem(Ce);if(!o)return[];const e=JSON.parse(o);return Array.isArray(e)?e.filter(t=>typeof t=="object"&&t!==null&&typeof t.id=="string"&&t.id.trim().length>0):[]}catch{return[]}}function ae(o){if(!(typeof window>"u"))try{localStorage.setItem(Ce,JSON.stringify(o))}catch(e){console.warn("Failed to write notebook index:",e)}}function Q(o,e){const t=q(),s=t.findIndex(a=>a.id===o);if(s>=0){const a=[...t];return a[s]={id:o,name:e},ae(a),a}else{const a=[...t,{id:o,name:e}];return ae(a),a}}function dt(){if(typeof window>"u")return null;try{const o=localStorage.getItem(Ne);return o&&o.trim().length>0?o.trim():null}catch{return null}}function X(o){if(!(typeof window>"u"))try{localStorage.setItem(Ne,o)}catch(e){console.warn("Failed to set last notebook ID:",e)}}const O={careNotes:[{time:"8:30 AM",note:"Wela enjoyed breakfast this morning. Had a good appetite and seemed happy.",author:"Lupe"},{time:"11:15 AM",note:"Took a nice walk around the garden together. The sunshine felt good on our faces.",author:"Lupe"},{time:"2:00 PM",note:"Resting comfortably this afternoon. We chatted a bit and Wela seemed peaceful.",author:"Lupe"}],tasks:[{id:"1",text:"Evening medication",completed:!1},{id:"2",text:"Call doctor's office about appointment",completed:!1}],lastUpdatedBy:"Lupe",currentCaregiver:"Lupe"},Y="care-app-notes-by-date",J="care-app-last-date",_="care-app-current-caregiver",z="care-app-last-updated-by",be="care-app-caretakers";function lt(){const o="care-app-care-notes",e=localStorage.getItem(o);if(e)try{const t=JSON.parse(e);if(Array.isArray(t)&&t.length>0){const s=w(),a=t.map(n=>({...n,author:n.author||"Lupe"})),r={[s]:a};return localStorage.setItem(Y,JSON.stringify(r)),localStorage.removeItem(o),r}}catch{}return{}}function B(){const o=localStorage.getItem(Y);if(o)try{const e=JSON.parse(o),t={};for(const[s,a]of Object.entries(e))t[s]=a.map(r=>({...r,author:r.author||"Lupe"}));return t}catch{return{}}return lt()}function re(o){const e=w(),t=localStorage.getItem(J);return t&&t!==e&&o[t]?(localStorage.setItem(J,e),o):((!t||t!==e)&&localStorage.setItem(J,e),o)}function j(o){localStorage.setItem(Y,JSON.stringify(o))}function K(){const o=localStorage.getItem(be);if(o)try{const s=JSON.parse(o);if(Array.isArray(s))if(s.length>0&&typeof s[0]=="string"){const a=s.map((r,n)=>({id:R(),name:r,isPrimary:n===0,isActive:!0}));return P(a),a}else{const a=s;if(!a.some(n=>n.isPrimary)&&a.length>0){const n=a.find(c=>c.isActive);if(n){const c=a.map(i=>({...i,isPrimary:i.name===n.name}));return P(c),c}}return a}}catch{}const e=localStorage.getItem(_)||O.currentCaregiver,t=[{id:R(),name:e,isPrimary:!0,isActive:!0}];return e==="Lupe"?t.push({id:R(),name:"Maria",isPrimary:!1,isActive:!0}):e==="Maria"?t.push({id:R(),name:"Lupe",isPrimary:!1,isActive:!0}):t.push({id:R(),name:"Lupe",isPrimary:!1,isActive:!0},{id:R(),name:"Maria",isPrimary:!1,isActive:!0}),P(t),t}function P(o){localStorage.setItem(be,JSON.stringify(o))}class ut{constructor(e){}async loadToday(){const e=B(),t=re(e),s=w(),r=(t[s]||O.careNotes).map(m=>({...m,author:m.author||"Lupe"})),n=localStorage.getItem(_)||O.currentCaregiver,c=localStorage.getItem(z)||O.lastUpdatedBy;let i=K();const l=i.findIndex(m=>m.name.toLowerCase()===n.toLowerCase());if(l===-1){const m=i.some(h=>h.isPrimary);i=[{id:R(),name:n,isPrimary:!m,isActive:!0},...i],P(i)}else i[l].isActive||(i=i.map(h=>h.name.toLowerCase()===n.toLowerCase()?{...h,isActive:!0}:h),P(i));const d=i.filter(m=>m.isPrimary).length;if(d===0&&i.length>0){const h=i.find(C=>C.name.toLowerCase()===n.toLowerCase()&&C.isActive)||i.find(C=>C.isActive);h&&(i=i.map(C=>({...C,isPrimary:C.name===h.name})),P(i))}else if(d>1){let m=!1;i=i.map(h=>h.isPrimary&&!m?(m=!0,h):{...h,isPrimary:!1}),P(i)}i.filter(m=>m.isActive).length===0&&i.length>0&&(i=i.map(m=>m.name.toLowerCase()===n.toLowerCase()?{...m,isActive:!0,isPrimary:!0}:m),P(i));const u=O.tasks;return{careNotes:r,tasks:u,currentCaregiver:n,lastUpdatedBy:c}}async addNote(e){const t=w(),s=localStorage.getItem(_)||O.currentCaregiver,a=ie(e,s),r=B(),n=r[t]||[],c=[a,...n],i={...r,[t]:c};return j(i),a}async updateNote(e,t){const s=w(),a=B(),r=a[s]||[];if(e<0||e>=r.length)throw new Error("Invalid note index");const n=de(r[e],t),c=[...r];c[e]=n;const i={...a,[s]:c};return j(i),n}async deleteNote(e){const t=w(),s=B(),a=s[t]||[];if(e<0||e>=a.length)throw new Error("Invalid note index");const r=a[e];let n=[...a];if(r.author!=="System"){const i=we(r.author,r.note);n.splice(e,1,i)}else n=n.filter((i,l)=>l!==e);const c={...s,[t]:n};j(c)}async toggleTask(e){}async addTask(e){throw new Error("Tasks are not persisted in localStorage adapter")}async updateTask(e,t){throw new Error("Tasks are not persisted in localStorage adapter")}async deleteTask(e){}async handoff(e){const t=w(),s=localStorage.getItem(_)||O.currentCaregiver,a=ce(s,e),r=B(),n=r[t]||[],c=[a,...n],i={...r,[t]:c};j(i),localStorage.setItem(_,e),localStorage.setItem(z,s)}async getNotesByDate(){const e=B();return re(e)}async notebookExists(){const e=localStorage.getItem(Y);if(e)try{const r=JSON.parse(e);if(r&&typeof r=="object"&&Object.values(r).some(c=>Array.isArray(c)&&c.length>0))return!0}catch{}const t=localStorage.getItem(_),s=localStorage.getItem(z);if(t||s)return!0;const a=localStorage.getItem("care-app-tasks");if(a)try{const r=JSON.parse(a);if(Array.isArray(r)&&r.length>0)return!0}catch{}return!1}async addCaretaker(e){const t=w(),s=K(),a=le(s,e);if(a.length===s.length)return;P(a);const r=fe(e),n=B(),c=n[t]||[],i=[r,...c],l={...n,[t]:i};j(l)}async archiveCaretaker(e){const t=w(),s=localStorage.getItem(_)||O.currentCaregiver,a=K(),{caretakers:r,canArchive:n,reason:c}=me(a,e,s);if(!n)throw new Error(c||"Cannot archive this caretaker");P(r);const i=he(e),l=B(),d=l[t]||[],f=[i,...d],u={...l,[t]:f};j(u)}async restoreCaretaker(e){const t=w(),s=K(),{caretakers:a,canRestore:r,reason:n}=ye(s,e);if(!r)throw new Error(n||"Cannot restore this caretaker");P(a);const c=pe(e),i=B(),l=i[t]||[],d=[c,...l],f={...i,[t]:d};j(f)}async setPrimaryCaretaker(e){const t=w(),s=K(),{caretakers:a,canSetPrimary:r,reason:n}=ue(s,e);if(!r)throw new Error(n||"Cannot set this caretaker as primary");P(a);const c=ke(e),i=B(),l=i[t]||[],d=[c,...l],f={...i,[t]:d};j(f)}async getCaretakers(){return K()}async updateCaretakerName(e,t){const s=w(),a=e.trim(),r=t.trim();if(!a||!r)throw new Error("Invalid name");if(a.toLowerCase()===r.toLowerCase())return;const n=K();if(n.some(N=>N.name.toLowerCase()===r.toLowerCase()))throw new Error("A caretaker with this name already exists");const c=n.findIndex(N=>N.name.toLowerCase()===a.toLowerCase());if(c===-1)throw new Error("Caretaker not found");const i=n.map((N,I)=>I===c?{...N,name:r}:N);P(i),localStorage.getItem(_)===a&&localStorage.setItem(_,r),localStorage.getItem(z)===a&&localStorage.setItem(z,r);const f=B();let u=!1;const m={};for(const[N,I]of Object.entries(f)){const x=I.map(S=>S.author===a?(u=!0,{...S,author:r}):S);m[N]=x}u&&j(m);const h=ge(a,r),C=m[s]||f[s]||[],p=[h,...C],A={...m,[s]:p};j(A)}}const mt={apiKey:"AIzaSyCw347LXoh-s4ZQXRsdwnwqcrQjfJiixyY",authDomain:"care-notebook-ccb1d.firebaseapp.com",projectId:"care-notebook-ccb1d",storageBucket:"care-notebook-ccb1d.firebasestorage.app",messagingSenderId:"251384508478",appId:"1:251384508478:web:13fa89bf593f89c25de16f",measurementId:"G-N133F28XZ5"},ve=Z().length===0?qe(mt):Z()[0],k=We(ve);let oe=null;try{typeof window<"u"&&typeof document<"u"&&(oe=He(ve))}catch{oe=null}class xe{notebookId;constructor(e){this.notebookId=e}async withRetry(e,t=3,s=1e3){let a=null;for(let r=0;r<=t;r++)try{return await e()}catch(n){if(a=n,n?.code==="resource-exhausted"||n?.code==="quota-exceeded"||n?.message&&n.message.includes("quota"))throw n;if(r<t){const i=s*Math.pow(2,r),l=new Date().toISOString();console.warn(`[${l}] Firestore error (attempt ${r+1}/${t+1}). Retrying in ${i}ms...`),await new Promise(d=>setTimeout(d,i));continue}throw n}throw a||new Error("Operation failed after retries")}getCaretakersCollection(){return H(k,"notebooks",this.notebookId,"caretakers")}firestoreCaretakerToDomain(e,t){return{id:t.id||e,name:t.name,isPrimary:t.isPrimary,isActive:t.isActive}}async findCaretakerByName(e){const t=e.trim();if(!t)return null;const s=this.getCaretakersCollection(),a=await U(s);for(const r of a.docs){const n=r.data();if(n.name.toLowerCase()===t.toLowerCase())return{id:r.id,data:n}}return null}async findCaretakerByIdOrName(e){try{const t=g(k,"notebooks",this.notebookId,"caretakers",e),s=await D(t);if(s.exists())return{id:s.id,data:s.data()}}catch{}return this.findCaretakerByName(e)}async loadCaretakersFromFirestore(){try{const e=this.getCaretakersCollection(),t=await U(e),s=[];return t.forEach(a=>{const r=a.data();s.push(this.firestoreCaretakerToDomain(a.id,r))}),s}catch(e){return e instanceof Error&&e.name==="AbortError"?[]:[]}}async loadCaretakers(){try{const e=this.getCaretakersCollection(),t=await U(e),s=[];return t.forEach(a=>{const r=a.data(),n=this.firestoreCaretakerToDomain(a.id,r);n.isActive&&s.push(n)}),s}catch(e){return e instanceof Error&&e.name==="AbortError"?[]:[]}}async getPrimaryCaretakerName(){try{return(await this.loadCaretakersFromFirestore()).find(s=>s.isPrimary&&s.isActive)?.name||""}catch(e){return e instanceof Error&&e.name==="AbortError",""}}async ensureNotebookInitialized(){const e=w(),t=g(k,"notebooks",this.notebookId,"today",e);if((await D(t)).exists())return;const a={careNotes:[],tasks:[],currentCaregiver:"",lastUpdatedBy:""};try{await this.withRetry(async()=>{await v(t,{...a,createdAt:T.now(),version:1})})}catch(r){if(r?.code==="resource-exhausted"||r?.code==="quota-exceeded"){const n=new Date().toISOString();console.error(`[${n}] Firestore quota exceeded during notebook initialization. Will retry on next operation.`);return}throw r}}async ensureTodayDocument(){const e=w(),t=g(k,"notebooks",this.notebookId,"today",e),s=await D(t),a=s.exists()?s.data():null,r=await this.loadCaretakers();if(r.length>0){let l=(r.find(m=>m.isPrimary)??r[0])?.name??"";a?.currentCaregiver&&r.some(h=>h.name.toLowerCase()===a.currentCaregiver.toLowerCase())&&(l=a.currentCaregiver);const d=(a?.tasks||[]).map(m=>({id:m.id,text:m.text,completed:m.completed!==void 0?m.completed:!1})),f={careNotes:a?.careNotes??[],tasks:d,currentCaregiver:l,lastUpdatedBy:a?.lastUpdatedBy??l};if(!a||a.currentCaregiver!==f.currentCaregiver||a.lastUpdatedBy!==f.lastUpdatedBy)try{await this.withRetry(async()=>{const m={currentCaregiver:f.currentCaregiver,lastUpdatedBy:f.lastUpdatedBy,createdAt:a?.createdAt??T.now(),version:1};a||(m.tasks=f.tasks,m.careNotes=f.careNotes),await v(t,m,{merge:!0})})}catch(m){if(m?.code==="resource-exhausted"||m?.code==="quota-exceeded"){const h=new Date().toISOString();return console.error(`[${h}] Firestore quota exceeded. Returning existing or computed state without writing.`),a||f}throw m}return f}if(a?.currentCaregiver)return a;const n=(a?.tasks||[]).map(i=>({id:i.id,text:i.text,completed:i.completed!==void 0?i.completed:!1})),c={careNotes:a?.careNotes??[],tasks:n,currentCaregiver:"",lastUpdatedBy:""};if(!a)try{await this.withRetry(async()=>{await v(t,{...c,createdAt:T.now(),version:1},{merge:!0})})}catch(i){if(i?.code==="resource-exhausted"||i?.code==="quota-exceeded"){const l=new Date().toISOString();return console.error(`[${l}] Firestore quota exceeded. Returning computed state without writing.`),c}throw i}return c}async loadToday(){try{return await this.ensureNotebookInitialized(),await this.ensureTodayDocument()}catch(e){if(e?.code==="resource-exhausted"||e?.code==="quota-exceeded"){const s=new Date().toISOString();return console.error(`[${s}] Firestore quota exceeded in loadToday. Returning empty state.`),{careNotes:[],tasks:[],currentCaregiver:"",lastUpdatedBy:""}}const t=new Date().toISOString();return console.error(`[${t}] Error loading today state:`,e),{careNotes:[],tasks:[],currentCaregiver:"",lastUpdatedBy:""}}}async addNote(e){await this.ensureNotebookInitialized();const t=w(),s=g(k,"notebooks",this.notebookId,"today",t),a=await this.withRetry(async()=>await D(s));let r;if(a.exists()){const d=a.data(),f=(d.tasks||[]).map(u=>({id:u.id,text:u.text,completed:u.completed!==void 0?u.completed:!1}));r={careNotes:d.careNotes||[],tasks:f,currentCaregiver:d.currentCaregiver||"",lastUpdatedBy:d.lastUpdatedBy||""}}else{const d=await this.getPrimaryCaretakerName();r={careNotes:[],tasks:[],currentCaregiver:d,lastUpdatedBy:d}}const n=r.currentCaregiver,c=ie(e,n),i=[c,...r.careNotes],l={...r,careNotes:i,lastUpdatedBy:n};return await this.withRetry(async()=>{await v(s,l,{merge:!0})}),c}async updateNote(e,t){await this.ensureNotebookInitialized();const s=w(),a=g(k,"notebooks",this.notebookId,"today",s),r=await this.withRetry(async()=>await D(a));let n;if(r.exists()){const d=r.data();n={careNotes:d.careNotes||[],tasks:d.tasks||[],currentCaregiver:d.currentCaregiver||"",lastUpdatedBy:d.lastUpdatedBy||""}}else throw new Error("Cannot update note: today document does not exist");if(e<0||e>=n.careNotes.length)throw new Error("Invalid note index");const c=de(n.careNotes[e],t),i=[...n.careNotes];i[e]=c;const l={...n,careNotes:i,lastUpdatedBy:n.currentCaregiver};return await this.withRetry(async()=>{await v(a,l,{merge:!0})}),c}async deleteNote(e){await this.ensureNotebookInitialized();const t=w(),s=g(k,"notebooks",this.notebookId,"today",t),a=await D(s);let r;if(a.exists()){const l=a.data();r={careNotes:l.careNotes||[],tasks:l.tasks||[],currentCaregiver:l.currentCaregiver||"",lastUpdatedBy:l.lastUpdatedBy||""}}else throw new Error("Cannot delete note: today document does not exist");if(e<0||e>=r.careNotes.length)throw new Error("Invalid note index");const n=r.careNotes[e];let c=[...r.careNotes];if(n.author!=="System"){const l=we(n.author,n.note);c.splice(e,1,l)}else c=c.filter((l,d)=>d!==e);const i={...r,careNotes:c,lastUpdatedBy:r.currentCaregiver};await v(s,i,{merge:!0})}async toggleTask(e){await this.ensureNotebookInitialized();const t=w(),s=g(k,"notebooks",this.notebookId,"today",t),a=await this.withRetry(async()=>await D(s));let r;if(a.exists()){const h=a.data(),C=(h.tasks||[]).map(p=>({id:p.id,text:p.text,completed:p.completed!==void 0?p.completed:!1}));r={careNotes:h.careNotes||[],tasks:C,currentCaregiver:h.currentCaregiver||"",lastUpdatedBy:h.lastUpdatedBy||""}}else{const h=await this.getPrimaryCaretakerName();r={careNotes:[],tasks:[],currentCaregiver:h,lastUpdatedBy:h}}const n=r.tasks.findIndex(h=>h.id===e);if(n===-1)return;const c=r.tasks[n],i=c.completed,l=[...r.tasks];l[n]={...l[n],completed:!i};const d=r.currentCaregiver,u=[i?nt(d,c.text):st(d,c.text),...r.careNotes],m={...r,tasks:l,careNotes:u,lastUpdatedBy:d};await this.withRetry(async()=>{await v(s,m,{merge:!0})})}async addTask(e){await this.ensureNotebookInitialized();const t=w(),s=g(k,"notebooks",this.notebookId,"today",t),a=await this.withRetry(async()=>await D(s));let r;if(a.exists()){const u=a.data(),m=(u.tasks||[]).map(h=>({id:h.id,text:h.text,completed:h.completed!==void 0?h.completed:!1}));r={careNotes:u.careNotes||[],tasks:m,currentCaregiver:u.currentCaregiver||"",lastUpdatedBy:u.lastUpdatedBy||""}}else{const u=await this.getPrimaryCaretakerName();r={careNotes:[],tasks:[],currentCaregiver:u,lastUpdatedBy:u}}const n={id:R(),text:e.trim(),completed:!1},c=[n,...r.tasks],i=r.currentCaregiver,d=[ot(i,n.text),...r.careNotes],f={...r,tasks:c,careNotes:d,lastUpdatedBy:i};return await this.withRetry(async()=>{await v(s,f,{merge:!0})}),n}async updateTask(e,t){await this.ensureNotebookInitialized();const s=w(),a=g(k,"notebooks",this.notebookId,"today",s),r=await this.withRetry(async()=>await D(a));let n;if(r.exists()){const p=r.data(),A=(p.tasks||[]).map(N=>({id:N.id,text:N.text,completed:N.completed!==void 0?N.completed:!1}));n={careNotes:p.careNotes||[],tasks:A,currentCaregiver:p.currentCaregiver||"",lastUpdatedBy:p.lastUpdatedBy||""}}else{const p=await this.getPrimaryCaretakerName();n={careNotes:[],tasks:[],currentCaregiver:p,lastUpdatedBy:p}}const c=n.tasks.findIndex(p=>p.id===e);if(c===-1)throw new Error("Task not found");const l=n.tasks[c].text,d=t.trim(),f=[...n.tasks];f[c]={...f[c],text:d};const u=n.currentCaregiver,h=[it(u,l,d),...n.careNotes],C={...n,tasks:f,careNotes:h,lastUpdatedBy:u};return await this.withRetry(async()=>{await v(a,C,{merge:!0})}),f[c]}async deleteTask(e){await this.ensureNotebookInitialized();const t=w(),s=g(k,"notebooks",this.notebookId,"today",t),a=await this.withRetry(async()=>await D(s));let r;if(a.exists()){const u=a.data(),m=(u.tasks||[]).map(h=>({id:h.id,text:h.text,completed:h.completed!==void 0?h.completed:!1}));r={careNotes:u.careNotes||[],tasks:m,currentCaregiver:u.currentCaregiver||"",lastUpdatedBy:u.lastUpdatedBy||""}}else return;const n=r.tasks.find(u=>u.id===e),c=r.tasks.filter(u=>u.id!==e);if(c.length===r.tasks.length)return;const i=r.currentCaregiver,d=[ct(i,n.text),...r.careNotes],f={...r,tasks:c,careNotes:d,lastUpdatedBy:i};await this.withRetry(async()=>{await v(s,f,{merge:!0})})}async handoff(e){await this.ensureNotebookInitialized();const t=w(),s=g(k,"notebooks",this.notebookId,"today",t),a=await D(s);let r;if(a.exists()){const d=a.data(),f=(d.tasks||[]).map(u=>({id:u.id,text:u.text,completed:u.completed!==void 0?u.completed:!1}));r={careNotes:d.careNotes||[],tasks:f,currentCaregiver:d.currentCaregiver||"",lastUpdatedBy:d.lastUpdatedBy||""}}else{const d=await this.getPrimaryCaretakerName();r={careNotes:[],tasks:[],currentCaregiver:d,lastUpdatedBy:d}}const n=r.currentCaregiver,i=[ce(n,e),...r.careNotes],l={...r,careNotes:i,currentCaregiver:e,lastUpdatedBy:e};await v(s,l,{merge:!0})}async getNotesByDate(){try{const e=H(k,"notebooks",this.notebookId,"today"),t=await U(e),s={};return t.forEach(a=>{const r=a.data(),n=a.id,c=r.careNotes||[];c.length>0&&(s[n]=c)}),s}catch(e){return e instanceof Error&&e.name==="AbortError"?{}:{}}}async notebookExists(){try{if((await this.loadCaretakersFromFirestore()).length>0)return!0;const t=H(k,"notebooks",this.notebookId,"today");return!(await U(t)).empty}catch(e){return e instanceof Error&&e.name==="AbortError",!1}}async addCaretaker(e){await this.ensureNotebookInitialized();const t=e.trim();if(!t)return;const s=await this.loadCaretakersFromFirestore();if(s.some(p=>p.name.toLowerCase()===t.toLowerCase()))throw new Error("Caretaker already exists");const a=le(s,t);if(a.length===s.length)return;const r=a.find(p=>p.name.toLowerCase()===t.toLowerCase());if(!r)return;const n=R(),c=R(),i=g(k,"notebooks",this.notebookId,"caretakers",c),l={id:n,name:r.name,isPrimary:r.isPrimary,isActive:r.isActive,createdAt:T.now()};if(await v(i,l),r.isPrimary){const p=this.getCaretakersCollection(),A=await U(p),N=[];A.forEach(I=>{if(I.id!==c&&I.data().isPrimary){const S=g(k,"notebooks",this.notebookId,"caretakers",I.id);N.push(L(S,{isPrimary:!1}))}}),await Promise.all(N)}const d=fe(t),f=w(),u=g(k,"notebooks",this.notebookId,"today",f),m=await this.loadToday(),h=[d,...m.careNotes],C={...m,careNotes:h};await v(u,C,{merge:!0}),await this.ensureTodayDocument()}async archiveCaretaker(e){await this.ensureNotebookInitialized();const t=await this.loadCaretakersFromFirestore(),s=await this.loadToday(),a=s.currentCaregiver,{canArchive:r,reason:n}=me(t,e,a);if(!r)throw new Error(n||"Cannot archive this caretaker");const c=await this.findCaretakerByIdOrName(e);if(!c)throw new Error("Caretaker not found");const i=g(k,"notebooks",this.notebookId,"caretakers",c.id);await L(i,{isActive:!1});const l=he(c.data.name),d=w(),f=g(k,"notebooks",this.notebookId,"today",d),u=[l,...s.careNotes],m={...s,careNotes:u};await v(f,m,{merge:!0}),await this.ensureTodayDocument()}async restoreCaretaker(e){await this.ensureNotebookInitialized();const t=await this.loadCaretakersFromFirestore(),{canRestore:s,reason:a}=ye(t,e);if(!s)throw new Error(a||"Cannot restore this caretaker");const r=await this.findCaretakerByIdOrName(e);if(!r)throw new Error("Caretaker not found");const n=g(k,"notebooks",this.notebookId,"caretakers",r.id);await L(n,{isActive:!0});const c=pe(r.data.name),i=w(),l=g(k,"notebooks",this.notebookId,"today",i),d=await this.loadToday(),f=[c,...d.careNotes],u={...d,careNotes:f};await v(l,u,{merge:!0}),await this.ensureTodayDocument()}async updateCaretakerName(e,t){await this.ensureNotebookInitialized();const s=e.trim(),a=t.trim();if(!s||!a)throw new Error("Invalid name");if(s.toLowerCase()===a.toLowerCase())return;if((await this.loadCaretakersFromFirestore()).some(A=>A.name.toLowerCase()===a.toLowerCase()))throw new Error("A caretaker with this name already exists");const n=await this.findCaretakerByIdOrName(s);if(!n)throw new Error("Caretaker not found");const c=g(k,"notebooks",this.notebookId,"caretakers",n.id);await L(c,{name:a});const i=H(k,"notebooks",this.notebookId,"today"),l=await U(i),d=[];l.forEach(A=>{const N=A.data(),I={};let x=!1;if(N.currentCaregiver===s&&(I.currentCaregiver=a,x=!0),N.lastUpdatedBy===s&&(I.lastUpdatedBy=a,x=!0),N.careNotes&&Array.isArray(N.careNotes)){const S=N.careNotes.map($=>$.author===s?{...$,author:a}:$);S.some(($,Ie)=>$.author!==N.careNotes[Ie].author)&&(I.careNotes=S,x=!0)}if(x){const S=g(k,"notebooks",this.notebookId,"today",A.id);d.push(L(S,I))}}),await Promise.all(d);const f=ge(s,a),u=w(),m=g(k,"notebooks",this.notebookId,"today",u),h=await this.loadToday(),C=[f,...h.careNotes],p={...h,careNotes:C};await v(m,p,{merge:!0})}async setPrimaryCaretaker(e){await this.ensureNotebookInitialized();const t=await this.loadCaretakersFromFirestore(),{canSetPrimary:s,reason:a}=ue(t,e);if(!s)throw new Error(a||"Cannot set this caretaker as primary");const r=await this.findCaretakerByIdOrName(e);if(!r)throw new Error("Caretaker not found");const n=this.getCaretakersCollection(),c=await U(n),i=[];c.forEach(C=>{const p=g(k,"notebooks",this.notebookId,"caretakers",C.id);C.id===r.id?i.push(L(p,{isPrimary:!0})):C.data().isPrimary&&i.push(L(p,{isPrimary:!1}))}),await Promise.all(i);const l=ke(r.data.name),d=w(),f=g(k,"notebooks",this.notebookId,"today",d),u=await this.loadToday(),m=[l,...u.careNotes],h={...u,careNotes:m};await v(f,h,{merge:!0}),await this.ensureTodayDocument()}async createNotebook(e){const t=g(k,"notebooks",this.notebookId),s=T.now();await v(t,{careeName:e.trim(),createdAt:s,lastOpenedAt:s})}async updateNotebookMetadata(e){const t=g(k,"notebooks",this.notebookId),s=await D(t),a=s.exists()&&s.data().careeName||"Care recipient",r=e.trim();if(a!==r){await L(t,{careeName:r,lastOpenedAt:T.now()});const n=rt(a,r),c=w(),i=g(k,"notebooks",this.notebookId,"today",c),l=await this.loadToday(),d=[n,...l.careNotes],f={...l,careNotes:d};await v(i,f,{merge:!0})}else await L(t,{lastOpenedAt:T.now()})}async getNotebookMetadata(){try{const e=g(k,"notebooks",this.notebookId),t=await D(e);if(t.exists()){const s=t.data();return{careeName:s.careeName||"Care recipient",createdAt:s.createdAt||T.now(),lastOpenedAt:s.lastOpenedAt||T.now()}}return{careeName:"Care recipient",createdAt:T.now(),lastOpenedAt:T.now()}}catch(e){return e instanceof Error&&e.name,{careeName:"Care recipient",createdAt:T.now(),lastOpenedAt:T.now()}}}async getCaretakers(){try{let e=await this.loadCaretakersFromFirestore();const s=(await this.loadToday()).currentCaregiver;if(s&&s.trim()){const n=s.trim();if(!e.some(i=>i.name.toLowerCase()===n.toLowerCase())){const i=R(),l=R(),d=g(k,"notebooks",this.notebookId,"caretakers",l),f=e.length===0,u={id:i,name:n,isPrimary:f,isActive:!0,createdAt:T.now()};if(await v(d,u),f&&e.length>0){const m=this.getCaretakersCollection(),h=await U(m),C=[];h.forEach(p=>{if(p.id!==l&&p.data().isPrimary){const N=g(k,"notebooks",this.notebookId,"caretakers",p.id);C.push(L(N,{isPrimary:!1}))}}),C.length>0&&await Promise.all(C)}e=await this.loadCaretakersFromFirestore()}}const a=[],r=new Set;for(const n of e){const c=n.name.toLowerCase();if(!r.has(c))a.push(n),r.add(c);else{const i=a.findIndex(d=>d.name.toLowerCase()===c),l=a[i];(n.isActive&&!l.isActive||n.isPrimary&&!l.isPrimary&&n.isActive===l.isActive)&&(a[i]=n)}}return a}catch(e){return e instanceof Error&&e.name==="AbortError"?[]:[]}}}function yt(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,o=>{const e=Math.random()*16|0;return(o==="x"?e:e&3|8).toString(16)})}function G(o){if(typeof window>"u")return;const e=new URL(window.location.href);e.searchParams.set("notebook",o),window.history.replaceState({},"",e.toString())}function V(){if(typeof window<"u"){const t=new URLSearchParams(window.location.search).get("notebook");if(t&&t.trim().length>0){const s=t.trim();return X(s),Q(s),s}}const o=dt();return o?(G(o),o):null}function ft(){const o=yt();return Q(o),X(o),G(o),o}function ht(o){G(o),X(o),Q(o)}class pt{firebaseAdapter;localStorageAdapter;constructor(e){this.firebaseAdapter=new xe(e),this.localStorageAdapter=new ut(e)}async loadToday(){return this.firebaseAdapter.loadToday()}async addNote(e){return this.firebaseAdapter.addNote(e)}async updateNote(e,t){return this.firebaseAdapter.updateNote(e,t)}async deleteNote(e){return this.firebaseAdapter.deleteNote(e)}async toggleTask(e){return this.firebaseAdapter.toggleTask(e)}async addTask(e){return this.firebaseAdapter.addTask(e)}async updateTask(e,t){return this.firebaseAdapter.updateTask(e,t)}async deleteTask(e){return this.firebaseAdapter.deleteTask(e)}async handoff(e){return this.localStorageAdapter.handoff(e)}async getNotesByDate(){return this.localStorageAdapter.getNotesByDate()}async notebookExists(){return this.localStorageAdapter.notebookExists()}async addCaretaker(e){return this.firebaseAdapter.addCaretaker(e)}async archiveCaretaker(e){return this.firebaseAdapter.archiveCaretaker(e)}async restoreCaretaker(e){return this.firebaseAdapter.restoreCaretaker(e)}async setPrimaryCaretaker(e){return this.firebaseAdapter.setPrimaryCaretaker(e)}async updateCaretakerName(e,t){return this.firebaseAdapter.updateCaretakerName(e,t)}async getCaretakers(){try{return await this.firebaseAdapter.getCaretakers()}catch(e){return e instanceof Error&&e.name==="AbortError"?[]:[]}}}function se(o){return new pt(o)}V();function kt(o){return new xe(o)}const Se=b.createContext(null);function Pt(){const o=b.useContext(Se);if(!o)throw new Error("useDataAdapter must be used within a DataAdapterProvider");return o}const gt=b.lazy(()=>F(()=>import("./Landing-C_KmipBN.js"),__vite__mapDeps([0,1,2,3,4]))),wt=b.lazy(()=>F(()=>import("./Today-BN79fusM.js"),__vite__mapDeps([5,1,2,3,6,4]))),Ct=b.lazy(()=>F(()=>import("./CareTeam-BI-BG7Kj.js"),__vite__mapDeps([7,1,2,3,6,4]))),Nt=b.lazy(()=>F(()=>import("./About-Cda3p7yt.js"),__vite__mapDeps([8,1,2,3]))),bt=b.lazy(()=>F(()=>import("./HowItWorks-Bv6prXzE.js"),__vite__mapDeps([9,1,2,3,4]))),vt=b.lazy(()=>F(()=>import("./Privacy-E4reZOwD.js"),__vite__mapDeps([10,1,2,3]))),ne="care-app-view";function xt(){const[o,e]=b.useState(()=>V()),[t,s]=b.useState(()=>{const x=localStorage.getItem(ne);return["home","today","careTeam","about","howItWorks","privacy"].includes(x)?x:"home"}),[a,r]=b.useState(()=>q()),[n,c]=b.useState(!1),i=b.useMemo(()=>se(o||""),[o]);b.useEffect(()=>{const x=()=>{const S=V();S&&S!==o&&e(S)};return window.addEventListener("popstate",x),()=>window.removeEventListener("popstate",x)},[o]),b.useEffect(()=>{o&&G(o)},[o]),b.useEffect(()=>{localStorage.setItem(ne,t)},[t]),b.useEffect(()=>{r(q())},[o]);const l=()=>{c(!0)},d=async x=>{const S=ft();await kt(S).createNotebook(x),e(S),r(q()),c(!1),s("today")},f=x=>{ht(x),e(x),r(q()),s("today")},u=()=>{l()},m=()=>{s("home")},h=()=>{s("careTeam")},C=()=>{s("today")},p=()=>{s("about")},A=()=>{s("howItWorks")},N=()=>{s("privacy")},I=t==="home"||t==="today"||t==="about"||t==="howItWorks"||t==="privacy";return y.jsxs(Se.Provider,{value:i,children:[y.jsxs(Ve,{onNavigateHome:m,onNavigateCareTeam:t==="today"?h:void 0,onNavigateBack:t==="careTeam"?C:void 0,currentView:t,children:[y.jsx(b.Suspense,{fallback:y.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:y.jsx(et,{size:"lg"})}),children:t==="today"?y.jsx(wt,{},o):t==="careTeam"?y.jsx(Ct,{},o):t==="about"?y.jsx(Nt,{}):t==="howItWorks"?y.jsx(bt,{}):t==="privacy"?y.jsx(vt,{}):y.jsx(gt,{onStartNotebook:l,onSwitchNotebook:f,onCreateAnotherNotebook:u,notebookIndex:a})}),I&&y.jsx(Qe,{onNavigateAbout:p,onNavigateHowItWorks:A,onNavigatePrivacy:N})]}),y.jsx(Xe,{isOpen:n,onClose:()=>c(!1),onSubmit:d})]})}window.addEventListener("unhandledrejection",o=>{if(o.reason instanceof Error&&o.reason.name==="AbortError"){o.preventDefault();return}o.preventDefault()});window.addEventListener("error",o=>{if(o.error instanceof Error&&o.error.name==="AbortError"){o.preventDefault();return}o.preventDefault()});Te.createRoot(document.getElementById("root")).render(y.jsx(b.StrictMode,{children:y.jsx(xt,{})}));export{Xe as C,M as I,et as S,Et as a,Dt as b,kt as c,me as d,ye as e,le as f,w as g,V as r,ue as s,Pt as u};
