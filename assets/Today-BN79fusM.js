import{r as l,j as e,F as m}from"./react-vendor-Bd7vrGHb.js";import{u as Ge,g as U,r as Te,c as Ee,S as Ve,I as u,a as Qe,b as _e,C as Je}from"./index-z5j_IKo6.js";import{I as h}from"./InlineSpinner-DVngfXjU.js";import"./vendor-B589Owoc.js";import"./fontawesome-vendor-BCNoqndA.js";import"./firebase-vendor-BzYfHYoF.js";function st(){const i=Ge(),[C,S]=l.useState({}),[f,T]=l.useState([]),[b,v]=l.useState([]),[_,ue]=l.useState(""),[me,J]=l.useState(""),[N,X]=l.useState(""),[Z,ee]=l.useState([]),[F,L]=l.useState(""),[De,te]=l.useState(null),[ae,K]=l.useState(""),[B,Ae]=l.useState(!0),[H,Fe]=l.useState(!0),[Le,q]=l.useState(!0),[P,fe]=l.useState(!1),[k,ye]=l.useState(!1),[O,z]=l.useState(null),[re,xe]=l.useState(null),[M,ge]=l.useState(""),[R,pe]=l.useState(!1),[ze,se]=l.useState(null),[oe,Y]=l.useState(""),[W,G]=l.useState(null),[ne,he]=l.useState(null),[V,Q]=l.useState(null),[$,be]=l.useState("Care recipient"),[Me,le]=l.useState(!1),[ve,Ne]=l.useState(new Set),ie=l.useRef(U()),$e=l.useRef(f),ce=l.useRef(!1);l.useEffect(()=>{$e.current=f},[f]);const E=l.useCallback(async(t=!1)=>{try{t&&q(!0);const a=await i.loadToday();T(a.careNotes),v(a.tasks),X(a.currentCaregiver),J(a.lastUpdatedBy);const r=await i.getCaretakers();ee(r);const s=r.filter(c=>c.isActive&&c.name!==a.currentCaregiver);s.length>0?L(s[0].name):L("");const n=await i.getNotesByDate();S(n);const o=Te();if(o){const g=await Ee(o).getNotebookMetadata();be(g.careeName)}ie.current=U()}catch(a){if(a instanceof Error&&a.name==="AbortError"){t&&q(!1);return}console.error("Error loading state:",a),t&&q(!1)}finally{t&&q(!1)}},[i]);l.useEffect(()=>{ce.current||(ce.current=!0,E(!0))},[]),l.useEffect(()=>{const t=ke();t.length>0&&ve.size===0&&Ne(new Set([t[0].dateKey]))},[C]),l.useEffect(()=>{const t=()=>{document.visibilityState==="visible"&&E()},a=()=>{E()};return document.addEventListener("visibilitychange",t),window.addEventListener("focus",a),()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("focus",a)}},[E]),l.useEffect(()=>{if(!ce.current)return;const t=setInterval(()=>{document.visibilityState==="visible"&&E()},3e4);return()=>clearInterval(t)},[E]),l.useEffect(()=>{const t=async()=>{try{const r=U(),s=ie.current;if(s&&s!==r){const n=await i.loadToday();T(n.careNotes),v(n.tasks),X(n.currentCaregiver),J(n.lastUpdatedBy);const o=await i.getCaretakers();ee(o);const c=o.filter(y=>y.isActive&&y.name!==n.currentCaregiver);c.length>0&&L(c[0].name);const g=await i.getNotesByDate();S(g),ie.current=r}}catch(r){if(r instanceof Error&&r.name==="AbortError")return}};t();const a=setInterval(t,6e4);return()=>clearInterval(a)},[]);const je=t=>{const a=new Date(t+"T00:00:00"),r=new Date,n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a.getDay()],o=a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:a.getFullYear()!==r.getFullYear()?"numeric":void 0});return`${n}, ${o}`},Ie=t=>{Ne(a=>{const r=new Set(a);return r.has(t)?r.delete(t):r.add(t),r})},Ce=()=>{const t=U(),a=[],r={};for(const n of f){let o=!1;for(const c of Object.keys(C))if((C[c]||[]).find(p=>p.time===n.time&&p.author===n.author&&p.note===n.note)){r[c]||(r[c]=[]),r[c].push(n),o=!0;break}o||(r[t]||(r[t]=[]),r[t].push(n))}const s=Object.keys(r).filter(n=>r[n]&&r[n].length>0).sort((n,o)=>o.localeCompare(n));for(const n of s)a.push({dateKey:n,dateLabel:je(n),notes:r[n]});return a},ke=()=>{const t=U(),a=[],r=Object.keys(C).filter(s=>s!==t&&C[s]&&C[s].length>0).sort((s,n)=>n.localeCompare(s)).slice(0,3);for(const s of r)a.push({dateKey:s,dateLabel:je(s),notes:C[s]});return a},Ue=async()=>{if(_.trim()&&!P)try{fe(!0);const t=await i.addNote(_.trim());T([t,...f]),ue("");const a=await i.getNotesByDate();S(a)}catch(t){if(t instanceof Error&&t.name==="AbortError")return;let a="Failed to add comment. Please try again.";t instanceof Error&&(t.message.includes("quota")||t.message.includes("resource-exhausted")||t?.code==="resource-exhausted"?a="Unable to add comment: Firebase quota exceeded. Please try again later or contact support.":a=t.message||a),alert(a)}finally{fe(!1)}},we=async()=>{const t=Z.filter(r=>r.isActive&&r.name!==N);if(t.length===0||k)return;let a;F&&t.some(r=>r.name===F)?a=F:a=t[0].name;try{ye(!0),await i.handoff(a);const r=await i.loadToday();T(r.careNotes),v(r.tasks),X(r.currentCaregiver),J(r.lastUpdatedBy);const s=await i.getCaretakers();ee(s);const n=s.filter(c=>c.isActive&&c.name!==r.currentCaregiver);n.length>0&&L(n[0].name);const o=await i.getNotesByDate();S(o)}catch(r){if(r instanceof Error&&r.name==="AbortError")return}finally{ye(!1)}},Ke=t=>{z(null),te(t),K(f[t].note)},Be=()=>{te(null),K("")},He=async t=>{if(ae.trim()&&O!==t)try{z(t);const a=await i.updateNote(t,ae.trim()),r=[...f];r[t]=a,T(r);const s=await i.getNotesByDate();S(s),z(null),te(null),K("")}catch(a){if(a instanceof Error&&a.name==="AbortError"){z(null);return}let r="Failed to save comment. Please try again.";a instanceof Error&&(a.message.includes("quota")||a.message.includes("resource-exhausted")||a?.code==="resource-exhausted"?r="Unable to save comment: Firebase quota exceeded. Please try again later or contact support.":r=a.message||r),alert(r),z(null)}},qe=async t=>{if(re!==t)try{xe(t),await i.deleteNote(t);const a=f.filter((s,n)=>n!==t);T(a);const r=await i.getNotesByDate();S(r)}catch(a){if(a instanceof Error&&a.name==="AbortError")return}finally{xe(null)}},Pe=async()=>{if(M.trim()&&!R)try{pe(!0);const t=await i.addTask(M.trim());v([t,...b]),ge("")}catch(t){if(t instanceof Error&&t.name==="AbortError")return;let a="Failed to add task. Please try again.";t instanceof Error&&(t.message.includes("quota")||t.message.includes("resource-exhausted")||t?.code==="resource-exhausted"?a="Unable to add task: Firebase quota exceeded. Please try again later or contact support.":a=t.message||a),alert(a)}finally{pe(!1)}},Oe=t=>{const a=b.find(r=>r.id===t);a&&(se(t),Y(a.text))},Re=()=>{se(null),Y("")},Ye=async t=>{if(oe.trim()&&W!==t)try{G(t);const a=await i.updateTask(t,oe.trim());v(b.map(r=>r.id===t?a:r)),G(null),se(null),Y("")}catch(a){if(a instanceof Error&&a.name==="AbortError"){G(null);return}let r="Failed to save task. Please try again.";a instanceof Error&&(a.message.includes("quota")||a.message.includes("resource-exhausted")||a?.code==="resource-exhausted"?r="Unable to save task: Firebase quota exceeded. Please try again later or contact support.":r=a.message||r),alert(r),G(null)}},We=async t=>{if(ne!==t)try{he(t),await i.deleteTask(t),v(b.filter(a=>a.id!==t))}catch(a){if(a instanceof Error&&a.name==="AbortError")return}finally{he(null)}};return e.jsxs("main",{className:"min-h-screen",style:{backgroundColor:"var(--bg-primary)"},children:[e.jsx("div",{className:"px-6 py-8 max-w-2xl mx-auto",children:Le?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(Ve,{size:"lg"})}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-normal mb-8 leading-tight",style:{color:"var(--text-primary)"},children:"Today"}),e.jsxs("header",{className:"mb-8 pb-6 border-b",style:{borderColor:"var(--border-color)"},children:[e.jsxs("h2",{className:"text-lg font-normal mb-2 inline-flex items-center gap-2",style:{color:"var(--text-secondary)"},children:[e.jsx(m,{icon:u.notebook,className:"mr-2 opacity-75",style:{fontSize:"0.95em"},"aria-hidden":"true"}),e.jsxs("span",{children:["Today — ",$]}),e.jsx("button",{type:"button",onClick:()=>le(!0),className:"p-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80",style:{color:"var(--text-secondary)","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Edit care recipient name",title:"Edit care recipient name",children:e.jsx(m,{icon:u.quickNote,style:{fontSize:"0.75em"},"aria-hidden":"true"})})]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:["Current caregiver: ",e.jsx("span",{className:"font-medium",style:{color:"var(--text-secondary)"},"aria-label":`Current caregiver is ${N}`,children:N})]})]}),f.length===0&&b.length===0&&e.jsx("section",{className:"mb-8",children:e.jsxs("p",{className:"text-base leading-relaxed",style:{color:"var(--text-secondary)"},children:["This is today's shared care notebook. Add notes as things happen, and they'll be here for everyone helping care for ",$,"."]})}),e.jsxs("section",{className:"mb-12","aria-labelledby":"quick-note-heading",children:[e.jsxs("h2",{id:"quick-note-heading",className:"text-xl font-normal mb-4",style:{color:"var(--text-primary)"},children:[e.jsx(m,{icon:u.quickNote,className:"mr-2 opacity-70",style:{fontSize:"0.85em"},"aria-hidden":"true"}),"Quick note"]}),e.jsxs("form",{className:"space-y-3",onSubmit:t=>{t.preventDefault(),Ue()},"aria-label":"Add a care note",children:[e.jsx("label",{htmlFor:"note-textarea",className:"sr-only",children:"Note text"}),e.jsx("textarea",{id:"note-textarea",value:_,onChange:t=>ue(t.target.value),placeholder:"Add a note about care, symptoms, or anything that feels important…",className:"w-full px-4 py-3 text-base rounded-lg border focus:outline-none focus:ring-2 focus:border-transparent resize-y min-h-[100px] leading-relaxed",style:{color:"var(--text-primary)",backgroundColor:"var(--bg-primary)",borderColor:"var(--border-color)","--tw-ring-color":"var(--focus-ring)"},rows:4,"aria-label":"Add a note about care, symptoms, or anything that feels important","aria-required":"false"}),e.jsxs("button",{type:"submit",disabled:P,className:"w-full sm:w-auto px-6 py-3 text-base font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",style:{color:"var(--button-secondary-text)",backgroundColor:"var(--button-secondary-bg)","--tw-ring-color":"var(--focus-ring)"},onMouseEnter:t=>{P||(t.currentTarget.style.backgroundColor="var(--button-secondary-bg-hover)")},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="var(--button-secondary-bg)"},"aria-label":"Add note to care notebook",children:[P&&e.jsx(h,{size:"sm"}),"Add note"]})]})]}),e.jsxs("section",{className:"mb-6","aria-labelledby":"care-notes-heading",children:[e.jsxs("button",{type:"button",onClick:()=>Ae(!B),className:"w-full flex items-center justify-between text-left mb-2 focus:outline-none focus:ring-2 focus:ring-offset-2 rounded-lg px-2 py-1 -ml-2 hover:opacity-80 transition-opacity",style:{"--tw-ring-color":"var(--focus-ring)"},"aria-expanded":B,"aria-controls":"care-notes-content",children:[e.jsxs("h2",{id:"care-notes-heading",className:"text-lg font-normal inline-flex items-center",style:{color:"var(--text-secondary)"},children:[e.jsx(m,{icon:u.careNotes,className:"mr-2 opacity-60",style:{fontSize:"0.85em"},"aria-hidden":"true"}),"Care Notes",f.length>0&&e.jsxs("span",{className:"ml-2 text-sm font-normal",style:{color:"var(--text-muted)"},children:["(",f.length,")"]})]}),e.jsx(m,{icon:B?u.chevronUp:u.chevronDown,className:"opacity-50",style:{fontSize:"0.75em",color:"var(--text-secondary)"},"aria-hidden":"true"})]}),e.jsx("div",{id:"care-notes-content",className:B?"":"hidden",children:f.length===0?e.jsxs("div",{className:"py-6",role:"status","aria-live":"polite",children:[e.jsx("p",{className:"text-base mb-2",style:{color:"var(--text-secondary)"},children:"No notes yet today"}),e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:["When you add a note, it will appear here for everyone caring for ",$,"."]})]}):e.jsx("div",{className:"space-y-6",role:"list","aria-label":"Care notes",children:Ce().map(t=>{let a=0;const r=Ce();for(const s of r){if(s.dateKey===t.dateKey)break;a+=s.notes.length}return e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-medium mb-3",style:{color:"var(--text-secondary)"},children:t.dateLabel}),t.notes.length===0?e.jsx("p",{className:"text-sm py-2",style:{color:"var(--text-muted)"},children:"No notes for this day."}):e.jsx("div",{className:"space-y-4",children:t.notes.map((s,n)=>{const o=a+n,g=((d,w)=>{try{const[j,x]=d.split(" "),[A,de]=j.split(":");let I=parseInt(A,10);x==="PM"&&I!==12&&(I+=12),x==="AM"&&I===12&&(I=0);const Se=new Date(w+"T00:00:00");return Se.setHours(I,parseInt(de,10)),Se.toISOString()}catch{return""}})(s.time,t.dateKey),y=De===o,p=Qe(s,N),D=_e(s,N);return e.jsx("article",{className:"border-b pb-4 last:border-b-0",style:{borderColor:"var(--border-color)"},role:"listitem",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("time",{className:"text-sm font-medium whitespace-nowrap",style:{color:"var(--text-muted)"},dateTime:g||void 0,"aria-label":`Note added at ${s.time} on ${t.dateLabel}`,children:[e.jsx(m,{icon:u.time,className:"mr-1 opacity-60",style:{fontSize:"0.85em"},"aria-hidden":"true"}),s.time]}),e.jsx("div",{className:"flex-1",children:y?e.jsxs("div",{className:"space-y-2",children:[e.jsx("textarea",{value:ae,onChange:d=>K(d.target.value),className:"w-full px-4 py-3 text-base rounded-lg border focus:outline-none focus:ring-2 focus:border-transparent resize-y min-h-[100px] leading-relaxed",style:{color:"var(--text-primary)",backgroundColor:"var(--bg-primary)",borderColor:"var(--border-color)","--tw-ring-color":"var(--focus-ring)"},rows:4,autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>He(o),disabled:O===o,className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",style:{color:"var(--button-secondary-text)",backgroundColor:"var(--button-secondary-bg)","--tw-ring-color":"var(--focus-ring)"},onMouseEnter:d=>{O!==o&&(d.currentTarget.style.backgroundColor="var(--button-secondary-bg-hover)")},onMouseLeave:d=>{d.currentTarget.style.backgroundColor="var(--button-secondary-bg)"},"aria-label":"Save edited note",children:[O===o&&e.jsx(h,{size:"sm"}),"Save"]}),e.jsx("button",{type:"button",onClick:Be,className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Cancel editing",children:"Cancel"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("p",{className:"text-base leading-relaxed flex-1",style:{color:s.author==="System"?"var(--text-muted)":"var(--text-primary)",fontStyle:s.author==="System"?"italic":"normal"},children:s.note}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[p&&e.jsx("button",{type:"button",onClick:()=>Ke(o),className:"text-sm px-2 py-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Edit note",children:"Edit"}),D&&e.jsx("button",{type:"button",onClick:()=>qe(o),disabled:re===o,className:"text-sm px-2 py-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-1",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Delete note",children:re===o?e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"sm"}),e.jsx("span",{className:"sr-only",children:"Deleting..."})]}):"Delete"})]})]}),e.jsxs("p",{className:"text-xs mt-1.5",style:{color:"var(--text-light)"},"aria-label":`Noted by ${s.author}`,children:["— ",s.author,s.editedAt&&(()=>{try{const d=new Date(s.editedAt),w=new Date,j=d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:d.getFullYear()!==w.getFullYear()?"numeric":void 0}),x=d.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),A=`${j} at ${x}`,de=`Note was edited on ${j} at ${x}`;return e.jsxs("span",{className:"ml-2",style:{color:"var(--text-muted)"},"aria-label":de,children:["(edited at ",A,")"]})}catch{return e.jsx("span",{className:"ml-2",style:{color:"var(--text-muted)"},"aria-label":"Note was edited",children:"(edited)"})}})()]})]})})]})},o)})})]},t.dateKey)})})})]}),e.jsxs("section",{className:"mb-12","aria-labelledby":"tasks-heading",children:[e.jsxs("h2",{id:"tasks-heading",className:"text-xl font-normal mb-4",style:{color:"var(--text-primary)"},children:[e.jsx(m,{icon:u.tasks,className:"mr-2 opacity-70",style:{fontSize:"0.85em"},"aria-hidden":"true"}),"What matters next"]}),e.jsxs("form",{className:"mb-6 space-y-3",onSubmit:t=>{t.preventDefault(),Pe()},"aria-label":"Add a task",children:[e.jsx("label",{htmlFor:"task-input",className:"sr-only",children:"Task text"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"task-input",type:"text",value:M,onChange:t=>ge(t.target.value),placeholder:"Add a task or reminder…",className:"flex-1 px-4 py-3 text-base rounded-lg border focus:outline-none focus:ring-2 focus:border-transparent",style:{color:"var(--text-primary)",backgroundColor:"var(--bg-primary)",borderColor:"var(--border-color)","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Add a task or reminder"}),e.jsxs("button",{type:"submit",disabled:R||!M.trim(),className:"px-6 py-3 text-base font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",style:{color:"var(--button-secondary-text)",backgroundColor:"var(--button-secondary-bg)","--tw-ring-color":"var(--focus-ring)"},onMouseEnter:t=>{!R&&M.trim()&&(t.currentTarget.style.backgroundColor="var(--button-secondary-bg-hover)")},onMouseLeave:t=>{t.currentTarget.style.backgroundColor="var(--button-secondary-bg)"},"aria-label":"Add task",children:[R&&e.jsx(h,{size:"sm"}),"Add"]})]})]}),(()=>{const t=b.filter(s=>!s.completed),a=b.filter(s=>s.completed),r=s=>{const n=ze===s.id;return e.jsxs("li",{className:"flex items-start gap-3",role:"listitem",children:[e.jsxs("div",{className:"relative mt-1",children:[e.jsx("input",{type:"checkbox",id:s.id,checked:s.completed,onChange:async()=>{if(V===s.id)return;const o=s.id;try{Q(o),await i.toggleTask(o);const c=await i.loadToday();v(c.tasks),setTimeout(()=>{Q(null)},100)}catch(c){if(c instanceof Error&&c.name==="AbortError"){Q(null);return}const g=await i.loadToday();v(g.tasks),setTimeout(()=>{Q(null)},100)}},className:"w-5 h-5 rounded focus:ring-2 focus:ring-offset-2 cursor-pointer",style:{accentColor:"var(--text-primary)",borderColor:"var(--border-color)","--tw-ring-color":"var(--text-primary)",opacity:V===s.id?.5:1},"aria-label":`${s.text}, ${s.completed?"completed":"not completed"}`,"aria-checked":s.completed,disabled:n||V===s.id}),V===s.id&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx(h,{size:"sm"})})]}),e.jsx("div",{className:"flex-1",children:n?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:oe,onChange:o=>Y(o.target.value),className:"w-full px-4 py-2 text-base rounded-lg border focus:outline-none focus:ring-2 focus:border-transparent",style:{color:"var(--text-primary)",backgroundColor:"var(--bg-primary)",borderColor:"var(--border-color)","--tw-ring-color":"var(--focus-ring)"},autoFocus:!0}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>Ye(s.id),disabled:W===s.id,className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",style:{color:"var(--button-secondary-text)",backgroundColor:"var(--button-secondary-bg)","--tw-ring-color":"var(--focus-ring)"},onMouseEnter:o=>{W!==s.id&&(o.currentTarget.style.backgroundColor="var(--button-secondary-bg-hover)")},onMouseLeave:o=>{o.currentTarget.style.backgroundColor="var(--button-secondary-bg)"},"aria-label":"Save edited task",children:[W===s.id&&e.jsx(h,{size:"sm"}),"Save"]}),e.jsx("button",{type:"button",onClick:Re,className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Cancel editing",children:"Cancel"})]})]}):e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("label",{htmlFor:s.id,className:"text-base leading-relaxed flex-1 cursor-pointer",style:{color:s.completed?"var(--text-light)":"var(--text-primary)",textDecoration:s.completed?"line-through":"none"},children:s.text}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>Oe(s.id),className:"text-sm px-2 py-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Edit task",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>We(s.id),disabled:ne===s.id,className:"text-sm px-2 py-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-1",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Delete task",children:ne===s.id?e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"sm"}),e.jsx("span",{className:"sr-only",children:"Deleting..."})]}):"Delete"})]})]})})]},s.id)};return e.jsxs(e.Fragment,{children:[t.length>0?e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-normal mb-3",style:{color:"var(--text-secondary)"},children:"To do"}),e.jsx("ul",{className:"space-y-3",role:"list","aria-label":"Tasks to do",children:t.map(r)})]}):b.length===0?e.jsxs("div",{className:"py-2",role:"status",children:[e.jsx("p",{className:"text-base",style:{color:"var(--text-secondary)"},children:"No upcoming tasks added yet."}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--text-muted)"},children:"Use the form above to add reminders for follow-up care, medications, appointments, or anything that needs to happen next."})]}):null,a.length>0&&e.jsxs("div",{className:"border-t pt-6",style:{borderColor:"var(--border-color)"},children:[e.jsx("h3",{className:"text-lg font-normal mb-3",style:{color:"var(--text-secondary)"},children:"Complete"}),e.jsx("ul",{className:"space-y-3",role:"list","aria-label":"Completed tasks",children:a.map(r)})]})]})})()]}),e.jsxs("section",{className:"border-t pt-8 mt-10",style:{borderColor:"var(--border-color)"},"aria-labelledby":"handoff-heading",children:[e.jsxs("h2",{id:"handoff-heading",className:"text-xl font-normal mb-4",style:{color:"var(--text-primary)"},children:[e.jsx(m,{icon:u.handoff,className:"mr-2 opacity-70",style:{fontSize:"0.85em"},"aria-hidden":"true"}),"Handoff"]}),Z.length===0?e.jsx("div",{className:"space-y-3 text-base",style:{color:"var(--text-secondary)"},children:e.jsxs("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:["No caregivers have been added yet. Go to Care Team to add the people helping care for ",$,"."]})}):e.jsxs("div",{className:"space-y-3 text-base",style:{color:"var(--text-secondary)"},children:[e.jsxs("p",{children:["Last updated by: ",e.jsx("span",{className:"font-medium",style:{color:"var(--text-primary)"},"aria-label":`Last updated by ${me||"nobody yet"}`,children:me||"nobody yet"})]}),e.jsxs("p",{children:["Current caregiver: ",e.jsx("span",{className:"font-medium",style:{color:"var(--text-primary)"},"aria-label":`Current caregiver is ${N||"not set"}`,children:N||"not set"})]}),(()=>{const t=Z.filter(a=>a.isActive&&a.name!==N);if(t.length===0)return e.jsx("div",{className:"mt-4",children:e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No other active caretakers available for handoff."})});if(t.length===1){const a=t[0].name;return e.jsxs("button",{type:"button",onClick:we,disabled:k,className:"mt-4 px-6 py-3 text-base font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",style:{color:"var(--button-secondary-text)",backgroundColor:"var(--button-secondary-bg)","--tw-ring-color":"var(--focus-ring)"},onMouseEnter:r=>{k||(r.currentTarget.style.backgroundColor="var(--button-secondary-bg-hover)")},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="var(--button-secondary-bg)"},"aria-label":`Hand off care to ${a}`,children:[k?e.jsx(h,{size:"sm"}):e.jsx(m,{icon:u.handoff,className:"opacity-70",style:{fontSize:"0.85em"},"aria-hidden":"true"}),"Hand off care to ",a]})}return e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("label",{htmlFor:"handoff-select",className:"block text-sm",style:{color:"var(--text-secondary)"},children:"Hand off care to:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("select",{id:"handoff-select",value:F,onChange:a=>L(a.target.value),className:"flex-1 px-4 py-3 text-base rounded-lg border focus:outline-none focus:ring-2 focus:border-transparent",style:{color:"var(--text-primary)",backgroundColor:"var(--bg-primary)",borderColor:"var(--border-color)","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Select caregiver to hand off care to",children:t.map(a=>e.jsx("option",{value:a.name,children:a.name},a.id))}),e.jsxs("button",{type:"button",onClick:we,disabled:k,className:"px-6 py-3 text-base font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",style:{color:"var(--button-secondary-text)",backgroundColor:"var(--button-secondary-bg)","--tw-ring-color":"var(--focus-ring)"},onMouseEnter:a=>{k||(a.currentTarget.style.backgroundColor="var(--button-secondary-bg-hover)")},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="var(--button-secondary-bg)"},"aria-label":`Hand off care to ${F}`,children:[k?e.jsx(h,{size:"sm"}):e.jsx(m,{icon:u.handoff,className:"opacity-70",style:{fontSize:"0.85em"},"aria-hidden":"true"}),"Hand off"]})]})]})})()]})]}),(()=>{const t=ke();return t.length===0?null:e.jsxs("section",{className:"border-t pt-6 mt-6",style:{borderColor:"var(--border-color)"},"aria-labelledby":"earlier-heading",children:[e.jsxs("button",{type:"button",onClick:()=>Fe(!H),className:"w-full flex items-center justify-between text-left mb-2 focus:outline-none focus:ring-2 focus:ring-offset-2 rounded-lg px-2 py-1 -ml-2 hover:opacity-80 transition-opacity",style:{"--tw-ring-color":"var(--focus-ring)"},"aria-expanded":H,"aria-controls":"earlier-content",children:[e.jsxs("h2",{id:"earlier-heading",className:"text-lg font-normal inline-flex items-center",style:{color:"var(--text-secondary)"},children:[e.jsx(m,{icon:u.careNotes,className:"mr-2 opacity-60",style:{fontSize:"0.85em"},"aria-hidden":"true"}),"Earlier"]}),e.jsx(m,{icon:H?u.chevronUp:u.chevronDown,className:"opacity-50",style:{fontSize:"0.75em",color:"var(--text-secondary)"},"aria-hidden":"true"})]}),e.jsxs("div",{id:"earlier-content",className:H?"":"hidden",children:[t.length>0&&e.jsx("p",{className:"text-sm mb-4",style:{color:"var(--text-muted)"},children:"Click on any day to expand or collapse its notes."}),e.jsx("div",{className:"space-y-6",role:"list","aria-label":"Earlier care notes",children:t.map(a=>{const r=ve.has(a.dateKey);return e.jsxs("div",{role:"listitem",children:[e.jsxs("button",{type:"button",onClick:()=>Ie(a.dateKey),className:"w-full flex items-center justify-between text-left mb-3 focus:outline-none focus:ring-2 focus:ring-offset-2 rounded-lg px-2 py-1 -ml-2 hover:opacity-80 transition-opacity",style:{"--tw-ring-color":"var(--focus-ring)"},"aria-expanded":r,"aria-controls":`earlier-day-${a.dateKey}`,children:[e.jsx("h3",{className:"text-base font-medium",style:{color:"var(--text-secondary)"},children:a.dateLabel}),e.jsx(m,{icon:r?u.chevronUp:u.chevronDown,className:"opacity-50",style:{fontSize:"0.75em",color:"var(--text-secondary)"},"aria-hidden":"true"})]}),a.notes.length===0?e.jsx("p",{className:"text-sm py-2",style:{color:"var(--text-muted)"},children:"No notes for this day."}):e.jsx("ul",{id:`earlier-day-${a.dateKey}`,className:r?"space-y-2":"hidden",role:"list","aria-label":`Care notes for ${a.dateLabel}`,children:a.notes.map((s,n)=>{const o={...s,author:s.author||"Unknown"},g=((y,p)=>{try{const[D,d]=y.split(" "),[w,j]=D.split(":");let x=parseInt(w,10);d==="PM"&&x!==12&&(x+=12),d==="AM"&&x===12&&(x=0);const A=new Date(p+"T00:00:00");return A.setHours(x,parseInt(j,10)),A.toISOString()}catch{return""}})(o.time,a.dateKey);return e.jsxs("li",{className:"flex items-start gap-3",role:"listitem",children:[e.jsxs("time",{className:"text-sm font-medium whitespace-nowrap",style:{color:"var(--text-muted)"},dateTime:g||void 0,"aria-label":`Note added at ${o.time} on ${a.dateLabel}`,children:[e.jsx(m,{icon:u.time,className:"mr-1 opacity-60",style:{fontSize:"0.85em"},"aria-hidden":"true"}),o.time]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm leading-relaxed flex-1",style:{color:o.author==="System"?"var(--text-light)":"var(--text-secondary)",fontStyle:o.author==="System"?"italic":"normal"},children:o.note}),e.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--text-light)"},"aria-label":`Noted by ${o.author}`,children:["— ",o.author,o.editedAt&&(()=>{try{const y=new Date(o.editedAt),p=new Date,D=y.toLocaleDateString("en-US",{month:"short",day:"numeric",year:y.getFullYear()!==p.getFullYear()?"numeric":void 0}),d=y.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),w=`${D} at ${d}`,j=`Note was edited on ${D} at ${d}`;return e.jsxs("span",{className:"ml-2",style:{color:"var(--text-muted)"},"aria-label":j,children:["(edited at ",w,")"]})}catch{return e.jsx("span",{className:"ml-2",style:{color:"var(--text-muted)"},"aria-label":"Note was edited",children:"(edited)"})}})()]})]})]},n)})})]},a.dateKey)})})]})]})})()]})}),e.jsx(Je,{isOpen:Me,onClose:()=>le(!1),onSubmit:async t=>{try{const a=Te();a&&(await Ee(a).updateNotebookMetadata(t),be(t),le(!1))}catch(a){if(a instanceof Error&&a.name==="AbortError")return}},initialValue:$,title:"Update care recipient name",submitLabel:"Update"})]})}export{st as default};
