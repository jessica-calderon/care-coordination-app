import{r as n,j as r,F as M}from"./react-vendor-Bd7vrGHb.js";import{u as Q,S as V,I as $,r as W,c as X,s as Y,d as Z,e as _,f as ee}from"./index-z5j_IKo6.js";import{I as g}from"./InlineSpinner-DVngfXjU.js";import"./vendor-B589Owoc.js";import"./fontawesome-vendor-BCNoqndA.js";import"./firebase-vendor-BzYfHYoF.js";function ie(){const s=Q(),[l,i]=n.useState([]),[k,u]=n.useState(""),[f,N]=n.useState(""),[D,x]=n.useState(!0),[q,w]=n.useState(!1),[b,j]=n.useState(null),[C,S]=n.useState(null),[v,E]=n.useState(null),[A,K]=n.useState("Care recipient"),[m,I]=n.useState(null),[P,h]=n.useState(""),[y,T]=n.useState(null),L=n.useRef(!1),U=e=>{I(e.id),h(e.name)},p=()=>{I(null),h("")},R=async e=>{const a=P.trim();if(!a||a===e){p();return}try{T(e),await s.updateCaretakerName(e,a);const t=await s.getCaretakers();i(t);const o=await s.loadToday();u(o.currentCaregiver),p()}catch(t){if(t instanceof Error&&t.name==="AbortError")return;alert(t instanceof Error?t.message:"Failed to update caretaker name")}finally{T(null)}};n.useEffect(()=>{if(L.current)return;L.current=!0,(async()=>{try{x(!0);const a=await s.getCaretakers();i(a);const t=await s.loadToday();u(t.currentCaregiver);const o=W();if(o){const d=await X(o).getNotebookMetadata();K(d.careeName)}}catch(a){console.error("Error loading CareTeam state:",a),x(!1)}finally{x(!1)}})()},[]);const B=async()=>{if(f.trim()&&!q)try{w(!0);const e=f.trim(),a=ee(l,e),t=a.length>l.length;t&&(i(a),N("")),await s.addCaretaker(e);const o=await s.getCaretakers();(o.some(O=>O.name.toLowerCase()===e.toLowerCase())||o.length>=a.length)&&i(o);const d=await s.loadToday();u(d.currentCaregiver)}catch(e){if(e instanceof Error&&e.name==="AbortError")return;const a=await s.getCaretakers();i(a)}finally{w(!1)}},G=async e=>{if(b!==e)try{j(e);const{caretakers:a,canArchive:t}=Z(l,e,k);t&&i(a),await s.archiveCaretaker(e);const o=await s.getCaretakers();i(o);const c=await s.loadToday();u(c.currentCaregiver)}catch(a){if(a instanceof Error&&a.name==="AbortError")return;const t=await s.getCaretakers();i(t),alert(a instanceof Error?a.message:"Cannot archive this caregiver")}finally{j(null)}},H=async e=>{if(C!==e)try{S(e);const{caretakers:a,canRestore:t}=_(l,e);t&&i(a),await s.restoreCaretaker(e);const o=await s.getCaretakers();i(o);const c=await s.loadToday();u(c.currentCaregiver)}catch(a){if(a instanceof Error&&a.name==="AbortError")return;const t=await s.getCaretakers();i(t),alert(a instanceof Error?a.message:"Cannot restore this caregiver")}finally{S(null)}},J=async e=>{if(v!==e)try{E(e);const{caretakers:a,canSetPrimary:t}=Y(l,e);t&&i(a),await s.setPrimaryCaretaker(e);const o=await s.getCaretakers();i(o);const c=await s.loadToday();u(c.currentCaregiver)}catch(a){if(a instanceof Error&&a.name==="AbortError")return;const t=await s.getCaretakers();i(t),alert(a instanceof Error?a.message:"Cannot set this caregiver as primary")}finally{E(null)}},z=n.useMemo(()=>l.filter(e=>e.isActive),[l]),F=n.useMemo(()=>l.filter(e=>!e.isActive),[l]);return r.jsx("main",{className:"min-h-screen",style:{backgroundColor:"var(--bg-primary)"},children:r.jsx("div",{className:"px-6 py-8 max-w-2xl mx-auto",children:D?r.jsx("div",{className:"flex items-center justify-center py-16",children:r.jsx(V,{size:"lg"})}):r.jsxs(r.Fragment,{children:[r.jsxs("h1",{className:"text-3xl md:text-4xl font-normal mb-8 leading-tight",style:{color:"var(--text-primary)"},children:["Care Team for ",A]}),r.jsx("header",{className:"mb-8 pb-6 border-b",style:{borderColor:"var(--border-color)"},children:r.jsxs("p",{className:"text-base leading-relaxed",style:{color:"var(--text-secondary)"},children:["Manage the people who help care for ",A,". Changes here affect everyone on the care team."]})}),r.jsxs("section",{className:"mb-8","aria-labelledby":"active-caretakers-heading",children:[r.jsxs("h2",{id:"active-caretakers-heading",className:"text-xl font-normal mb-4",style:{color:"var(--text-primary)"},children:[r.jsx(M,{icon:$.caregiver,className:"mr-2 opacity-70",style:{fontSize:"0.85em"},"aria-hidden":"true"}),"Active Care Team"]}),z.length>0?r.jsx("ul",{className:"space-y-2 mb-6",role:"list","aria-label":"List of active caretakers",children:z.map(e=>{const a=e.name===k,t=e.isPrimary,o=!t&&!a,c=!t;return r.jsxs("li",{className:"flex items-center justify-between gap-3 py-3 px-4 border rounded-lg",style:{borderColor:"var(--border-color)"},role:"listitem",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[t&&r.jsx("span",{className:"text-base","aria-label":"Primary contact",title:"Primary contact",children:"⭐"}),m===e.id?r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[r.jsx("input",{type:"text",value:P,onChange:d=>h(d.target.value),onKeyDown:d=>{d.key==="Enter"?R(e.name):d.key==="Escape"&&p()},className:"flex-1 px-2 py-1 text-base rounded border focus:outline-none focus:ring-2 focus:border-transparent",style:{color:"var(--text-primary)",backgroundColor:"var(--bg-primary)",borderColor:"var(--border-color)","--tw-ring-color":"var(--focus-ring)"},autoFocus:!0,disabled:y===e.name}),r.jsx("button",{type:"button",onClick:()=>R(e.name),disabled:y===e.name,className:"text-sm px-2 py-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"var(--button-secondary-text)",backgroundColor:"var(--button-secondary-bg)","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Save caretaker name",children:y===e.name?r.jsx(g,{size:"sm"}):"Save"}),r.jsx("button",{type:"button",onClick:p,disabled:y===e.name,className:"text-sm px-2 py-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Cancel editing",children:"Cancel"})]}):r.jsxs(r.Fragment,{children:[r.jsx("span",{className:"text-base",style:{color:"var(--text-primary)"},children:e.name}),a&&r.jsx("span",{className:"text-xs px-2 py-0.5 rounded",style:{color:"var(--text-secondary)",backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-color)"},children:"Current"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[m!==e.id&&r.jsx("button",{type:"button",onClick:()=>U(e),className:"text-sm px-3 py-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 inline-flex items-center gap-2",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":`Edit ${e.name}'s name`,title:"Edit name",children:r.jsx(M,{icon:$.quickNote,style:{fontSize:"0.75em"},"aria-hidden":"true"})}),c&&m!==e.id&&r.jsxs("button",{type:"button",onClick:()=>J(e.name),disabled:v===e.name,className:"text-sm px-3 py-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":`Set ${e.name} as primary contact`,children:[v===e.name&&r.jsx(g,{size:"sm"}),"Set as primary"]}),o&&m!==e.id?r.jsxs("button",{type:"button",onClick:()=>G(e.name),disabled:b===e.name,className:"text-sm px-3 py-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":`Archive ${e.name}`,children:[b===e.name&&r.jsx(g,{size:"sm"}),"Archive"]}):m!==e.id?r.jsx("span",{className:"text-sm",style:{color:"var(--text-muted)"},title:t?"Cannot archive primary contact":"Cannot archive current caregiver",children:t?"Primary":"Current"}):null]})]},e.id)})}):r.jsx("div",{className:"py-4 mb-6",role:"status",children:r.jsx("p",{className:"text-base",style:{color:"var(--text-secondary)"},children:"No active caretakers. Please restore a caretaker below or add a new one."})})]}),F.length>0&&r.jsxs("section",{className:"mb-8","aria-labelledby":"inactive-caretakers-heading",children:[r.jsx("h2",{id:"inactive-caretakers-heading",className:"text-xl font-normal mb-4",style:{color:"var(--text-primary)"},children:"Inactive"}),r.jsx("ul",{className:"space-y-2",role:"list","aria-label":"List of inactive caretakers",children:F.map(e=>r.jsxs("li",{className:"flex items-center justify-between gap-3 py-3 px-4 border rounded-lg",style:{borderColor:"var(--border-color)"},role:"listitem",children:[r.jsx("div",{className:"flex items-center gap-2 flex-1",children:r.jsx("span",{className:"text-base",style:{color:"var(--text-muted)"},children:e.name})}),r.jsxs("button",{type:"button",onClick:()=>H(e.name),disabled:C===e.name,className:"text-sm px-3 py-1 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center gap-2",style:{color:"var(--text-secondary)",backgroundColor:"transparent","--tw-ring-color":"var(--focus-ring)"},"aria-label":`Restore ${e.name}`,children:[C===e.name&&r.jsx(g,{size:"sm"}),"Restore"]})]},e.id))})]}),r.jsxs("section",{className:"border-t pt-8 mt-8",style:{borderColor:"var(--border-color)"},"aria-labelledby":"add-caretaker-heading",children:[r.jsx("h2",{id:"add-caretaker-heading",className:"text-xl font-normal mb-4",style:{color:"var(--text-primary)"},children:"Add Care Team Member"}),r.jsxs("form",{className:"flex gap-2",onSubmit:e=>{e.preventDefault(),B()},"aria-label":"Add a new caretaker",children:[r.jsx("input",{type:"text",value:f,onChange:e=>N(e.target.value),placeholder:"Enter name…",className:"flex-1 px-4 py-3 text-base rounded-lg border focus:outline-none focus:ring-2 focus:border-transparent",style:{color:"var(--text-primary)",backgroundColor:"var(--bg-primary)",borderColor:"var(--border-color)","--tw-ring-color":"var(--focus-ring)"},"aria-label":"Caretaker name"}),r.jsx("button",{type:"submit",className:"px-6 py-3 text-base font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 cursor-pointer hover:opacity-80",style:{color:"var(--button-secondary-text)",backgroundColor:"var(--button-secondary-bg)","--tw-ring-color":"var(--focus-ring)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="var(--button-secondary-bg-hover)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="var(--button-secondary-bg)"},"aria-label":"Add caretaker",children:"Add"})]})]})]})})})}export{ie as default};
